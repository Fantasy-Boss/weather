$(document).ready(()=>{$(".input input").on("keyup",t=>{13===t.keyCode&&$(".submit").click()}),$(".location").click(),$(".submit").click(()=>{$(".alert").fadeOut(200);let t=$(".form-control:input").val(),e=`https://api.openweathermap.org/data/2.5/forecast?q=${t.toLowerCase()}&units=${"C"==$(".unit select").val()?"metric":"imperial"}&appid=d635965fdde6b6a73ec6deebac56962f`;validate(t)&&($(".load-div").slideDown(400),$("#map").hide(),$(".title").slideUp(400),getData(e,7))})}),geo=(()=>{$(".alert").fadeOut(200),navigator.geolocation?navigator.geolocation.getCurrentPosition(showPosition,showError):($(".alert").text("Geolocation is not supported by this browser"),$(".alert").fadeIn(200))}),showPosition=(t=>{let e="C"==$(".unit select").val()?"metric":"imperial",a=t.coords.latitude,i=t.coords.longitude;getData(`https://api.openweathermap.org/data/2.5/forecast?lat=${a}&lon=${i}&units=${e}&appid=d635965fdde6b6a73ec6deebac56962f`,9)}),showError=(t=>{let e="";switch(t.code){case t.PERMISSION_DENIED:e="User denied the request for Geolocation";break;case t.POSITION_UNAVAILABLE:e="Location information is unavailable";break;case t.TIMEOUT:e="The request to get user location timed out";break;case t.UNKNOWN_ERROR:e="An unknown error occurred."}$(".alert").text(e),$(".alert").fadeIn(200)}),validate=(t=>{if(""!=t)return!0;$(".alert").text("Enter a city name"),$(".alert").fadeIn(200)}),getData=((t,e)=>{navigator.onLine?($(".show").slideUp(200),$("#map").slideUp(200),$(".br").slideDown(),$(".load-div").slideDown(200),$.ajax({url:t,type:"GET",dataType:"json",success:t=>{let a="C"==$(".unit select").val()?"C":"F";parse(t,a,e)},error:t=>{$(".alert").text(JSON.parse(t.responseText).message),$(".alert").fadeIn(200)},complete:()=>{$(".load-div").slideUp(300)}})):($(".alert").text("No Internet Connection"),$(".alert").fadeIn(200))}),parse=((t,e,a)=>{let i=[];for(let a=0;a<t.list.length;a++){let o={date:t.list[a].dt_txt.split(" ")[0],day:{long:new Date(t.list[a].dt_txt).toLocaleString("en-US",{weekday:"long"}),short:new Date(t.list[a].dt_txt).toLocaleString("en-US",{weekday:"short"})},time:{num:new Date(t.list[a].dt_txt).getHours(),dis:new Date(t.list[a].dt_txt).toLocaleString("en-US",{hour:"numeric"})},unit:e,city:t.city.name,country:t.city.country,lon:t.city.coord.lon,lat:t.city.coord.lat,temp:Math.round(t.list[a].main.temp),temp_min:Math.round(t.list[a].main.temp_min),temp_max:Math.round(t.list[a].main.temp_max),weather:t.list[a].weather[0].main,icon:t.list[a].weather[0].icon,wind:(3.6*t.list[a].wind.speed).toFixed(1),humidity:t.list[a].main.humidity,clouds:t.list[a].clouds.all,pop:t.list[a].pop};(12==o.time.num||15==o.time.num&&o.icon.includes("n"))&&(o.icon=o.icon.split("n")[0]+"d"),i[a]=o}let o=[];for(let t=0;t<i.length;t++){let e=i[t].date;0==o.includes(e)&&o.push(e)}let n=[];for(let t=0;t<o.length;t++){let e=[];for(let a=0;a<i.length;a++)o[t]==i[a].date&&e.push(i[a]);n.push(e)}o=n,showCards(o),map(i[0].lon,i[0].lat,a)}),map=((t,e,a)=>{var i=`https://api.mapbox.com/styles/v1/mapbox/streets-v11/static/${t},${e},${a},0/500x300?access_token=pk.eyJ1Ijoia3VtYXI3NyIsImEiOiJja2p4d2xoamQwOGk0Mndxa2dsejhvZWFkIn0.tjdDV3TWFtlF1y0V_ASdMg`;$("#map img").attr("src",i),$("#map img").on("load",()=>{$("#map").slideDown(400)})}),showCards=(t=>{let e="",a=1,i="";if(1==a&&t[0][0].date==(new Date).toJSON().slice(0,10))for(let e=0;e<t[0].length;e++)t[0][e].time.num==(new Date).getHours()?a=e:t[0][e].time.num+1!=(new Date).getHours()&&t[0][e].time.num+2!=(new Date).getHours()||(a=e+1);for(let o=0;o<t.length-1;o++)e+=i=`<div class="card" onclick="showData(this)"><p>${t[o][a].day.short}</p><img \n        src="assets/image/icons/${icon(t[o][a].icon)}.svg"><p>${t[o][a].temp}&deg;${t[o][a].unit}</p></div>`,t[o].current=a,a=3;$(".bottom").html(e);let o=$(".card");for(let e=0;e<o.length;e++)o[e].data=t[e];o[0].click()}),showData=(t=>{let e=t.data[t.data.current],a=`<div class="top-1"><p>${e.day.long}</p><p class="dash"> - </p><p>${e.city}, ${e.country}</p></div>\n                <div class="top-2"><div class="top-icon"><img src="assets/image/icons/${icon(e.icon)}.svg"><br>\n                <p>${e.weather}</p></div><div class="top-temp"><p class="temp">${e.temp}&deg;${e.unit}</p>\n                <p class="min-max-temp">${e.temp_min}&deg;${e.unit} - ${e.temp_max}&deg;${e.unit}</p></div>\n                <div class="top-details"><p title="Chance of rain">Precipitation: ${e.pop}&#37;</p><br>\n                <p title="Amount of water vapor in the air">Humidity: ${e.humidity}&#37;</p><br>\n                <p title="Sky covered by clouds">Clouds: ${e.clouds}&#37;</p><br><p title="">Wind: ${e.wind} km/h</p>\n                </div></div>`;$(".top").html(a),$(".show").slideDown(400),$(".br").slideUp(400),chart(t.data)}),icon=(t=>{return{a01d:"day",a02d:"cloudy-day",a03d:"cloudy",a04d:"cloudy",a09d:"rainy",a10d:"rainy-day",a11d:"thunder",a13d:"snow",a50d:"mist",a01n:"night",a02n:"cloudy-night",a03n:"cloudy",a04n:"cloudy",a09n:"rainy",a10n:"rainy",a11n:"thunder",a13n:"snow",a50n:"mist"}[t="a"+t]}),chart=(t=>{let e=[],a=[];for(let i=0;i<t.length;i++)e[i]=t[i].time.dis,a[i]=t[i].temp;document.getElementById("canvas").data=t;var i=document.getElementById("canvas").getContext("2d"),o=new Chart(i,{type:"line",data:{labels:e,datasets:[{label:"Temperature",backgroundColor:"#f6ed0055",borderColor:"#f6ed00",pointHoverBorderColor:"#f68b00",pointHoverBorderWidth:9,data:a,borderWidth:2,pointBorderWidth:5}]},options:{scales:{xAxes:[{gridLines:{color:"rgba(0, 0, 0, 0)"}}],yAxes:[{ticks:{beginAtZero:!1,responsive:!0},gridLines:{color:"rgba(0, 0, 0, 0)"}}]}}});$("#canvas").off("click"),$("#canvas").click(e=>{var a=o.getElementsAtEventForMode(e,"point",o.options)[0];try{var i=o.data.labels[a._index];for(let e=0;e<t.length;e++)if(i==t[e].time.dis){t.current=e,showData({data:t})}chart(t)}catch{}})});